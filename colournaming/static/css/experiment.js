(()=>{var ue=Object.create;var C=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var fe=Object.getPrototypeOf,he=Object.prototype.hasOwnProperty;var me=t=>C(t,"__esModule",{value:!0});var pe=(t,i)=>()=>(i||t((i={exports:{}}).exports,i),i.exports);var ye=(t,i,h,s)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of de(i))!he.call(t,c)&&(h||c!=="default")&&C(t,c,{get:()=>i[c],enumerable:!(s=ce(i,c))||s.enumerable});return t},ge=(t,i)=>ye(me(C(t!=null?ue(fe(t)):{},"default",!i&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Y=pe(X=>{(function(t){"use strict";if(t.fetch)return;var i={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(i.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(e){return e&&DataView.prototype.isPrototypeOf(e)},c=ArrayBuffer.isView||function(e){return e&&h.indexOf(Object.prototype.toString.call(e))>-1};function d(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function y(e){return typeof e!="string"&&(e=String(e)),e}function v(e){var n={next:function(){var r=e.shift();return{done:r===void 0,value:r}}};return i.iterable&&(n[Symbol.iterator]=function(){return n}),n}function a(e){this.map={},e instanceof a?e.forEach(function(n,r){this.append(r,n)},this):Array.isArray(e)?e.forEach(function(n){this.append(n[0],n[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(n){this.append(n,e[n])},this)}a.prototype.append=function(e,n){e=d(e),n=y(n);var r=this.map[e];this.map[e]=r?r+","+n:n},a.prototype.delete=function(e){delete this.map[d(e)]},a.prototype.get=function(e){return e=d(e),this.has(e)?this.map[e]:null},a.prototype.has=function(e){return this.map.hasOwnProperty(d(e))},a.prototype.set=function(e,n){this.map[d(e)]=y(n)},a.prototype.forEach=function(e,n){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(n,this.map[r],r,this)},a.prototype.keys=function(){var e=[];return this.forEach(function(n,r){e.push(r)}),v(e)},a.prototype.values=function(){var e=[];return this.forEach(function(n){e.push(n)}),v(e)},a.prototype.entries=function(){var e=[];return this.forEach(function(n,r){e.push([r,n])}),v(e)},i.iterable&&(a.prototype[Symbol.iterator]=a.prototype.entries);function f(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function _(e){return new Promise(function(n,r){e.onload=function(){n(e.result)},e.onerror=function(){r(e.error)}})}function te(e){var n=new FileReader,r=_(n);return n.readAsArrayBuffer(e),r}function ne(e){var n=new FileReader,r=_(n);return n.readAsText(e),r}function re(e){for(var n=new Uint8Array(e),r=new Array(n.length),m=0;m<n.length;m++)r[m]=String.fromCharCode(n[m]);return r.join("")}function M(e){if(e.slice)return e.slice(0);var n=new Uint8Array(e.byteLength);return n.set(new Uint8Array(e)),n.buffer}function W(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,!e)this._bodyText="";else if(typeof e=="string")this._bodyText=e;else if(i.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(i.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(i.arrayBuffer&&i.blob&&s(e))this._bodyArrayBuffer=M(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else if(i.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e)))this._bodyArrayBuffer=M(e);else throw new Error("unsupported BodyInit type");this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i.blob&&(this.blob=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(te)}),this.text=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return ne(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(re(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i.formData&&(this.formData=function(){return this.text().then(se)}),this.json=function(){return this.text().then(JSON.parse)},this}var oe=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function ie(e){var n=e.toUpperCase();return oe.indexOf(n)>-1?n:e}function w(e,n){n=n||{};var r=n.body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,n.headers||(this.headers=new a(e.headers)),this.method=e.method,this.mode=e.mode,!r&&e._bodyInit!=null&&(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=n.credentials||this.credentials||"omit",(n.headers||!this.headers)&&(this.headers=new a(n.headers)),this.method=ie(n.method||this.method||"GET"),this.mode=n.mode||this.mode||null,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})};function se(e){var n=new FormData;return e.trim().split("&").forEach(function(r){if(r){var m=r.split("="),p=m.shift().replace(/\+/g," "),l=m.join("=").replace(/\+/g," ");n.append(decodeURIComponent(p),decodeURIComponent(l))}}),n}function ae(e){var n=new a,r=e.replace(/\r?\n[\t ]+/g," ");return r.split(/\r?\n/).forEach(function(m){var p=m.split(":"),l=p.shift().trim();if(l){var E=p.join(":").trim();n.append(l,E)}}),n}W.call(w.prototype);function b(e,n){n||(n={}),this.type="default",this.status=n.status===void 0?200:n.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in n?n.statusText:"OK",this.headers=new a(n.headers),this.url=n.url||"",this._initBody(e)}W.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new a(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var le=[301,302,303,307,308];b.redirect=function(e,n){if(le.indexOf(n)===-1)throw new RangeError("Invalid status code");return new b(null,{status:n,headers:{location:e}})},t.Headers=a,t.Request=w,t.Response=b,t.fetch=function(e,n){return new Promise(function(r,m){var p=new w(e,n),l=new XMLHttpRequest;l.onload=function(){var E={status:l.status,statusText:l.statusText,headers:ae(l.getAllResponseHeaders()||"")};E.url="responseURL"in l?l.responseURL:E.headers.get("X-Request-URL");var x="response"in l?l.response:l.responseText;r(new b(x,E))},l.onerror=function(){m(new TypeError("Network request failed"))},l.ontimeout=function(){m(new TypeError("Network request failed"))},l.open(p.method,p.url,!0),p.credentials==="include"?l.withCredentials=!0:p.credentials==="omit"&&(l.withCredentials=!1),"responseType"in l&&i.blob&&(l.responseType="blob"),p.headers.forEach(function(E,x){l.setRequestHeader(x,E)}),l.send(typeof p._bodyInit=="undefined"?null:p._bodyInit)})},t.fetch.polyfill=!0})(typeof self!="undefined"?self:X)});var _e=ge(Y()),u=JSON.parse(localStorage.getItem("results")),o=t=>{u=Object.assign({},u,t),localStorage.setItem("results",JSON.stringify(u))},L=document.getElementById("levels");window.location.href.endsWith("observer_information.html")&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){o({location:String(t.coords.latitude+","+t.coords.longitude)})});var B=(t,i)=>{let h=new FormData;h.append("csrf_token",document.getElementById("csrf_token").value),Object.keys(t).forEach(s=>{h.append(s,t[s])}),fetch(window.location,{body:h,credentials:"same-origin",method:"POST"}).then(()=>{typeof i=="string"&&(window.location=i)})};L!==null&&(o({greyscaleRampSteps:void 0}),L.addEventListener("change",()=>{let t=L.value;t!=="-"?(o({greyscaleRampSteps:parseInt(t,10)}),B({levels:t,screen_colour_depth:screen.colorDepth,screen_height:screen.height,screen_width:screen.width},"name_colour.html")):o({greyscaleRampSteps:void 0})}));var S=document.getElementById("colour-circle"),I=document.getElementById("colour-id"),g=document.getElementById("colour-name"),K=document.getElementById("colour-name-form"),Q=document.getElementById("colour-number"),Z=document.getElementById("colour-vision-test-page"),ve=document.getElementById("next-colour"),T=document.getElementById("response-time"),A=document.getElementById("start-time");if(S!==null&&I!==null&&g!==null&&K!==null&&Q!==null&&Z!==null&&ve!==null&&T!==null&&A!==null){o({colours:void 0});let t=()=>{fetch(COLOUR_NAME_TARGET_URL).then(s=>s.json()).then(({b:s,g:c,id:d,r:y})=>{S.style.backgroundColor=`rgb(${y}, ${c}, ${s})`,I.value=d,A.value=performance.now()})},i=()=>{let s={name:g.value,value:S.style.backgroundColor},c=u.colours?[...u.colours,s]:[s];o({colours:c})};t(),g.addEventListener("input",()=>{T.value===""&&(T.value=performance.now()-parseFloat(A.value))}),K.addEventListener("submit",s=>{s.preventDefault(),i(),B({name:g.value,response_time:parseFloat(T.value),target_id:I.value}),t(),g.value="",Q.textContent=`#${u.colours?u.colours.length+1:0}`,T.value="",g.focus()}),Z.addEventListener("click",s=>{s.preventDefault(),g.value!==""?(i(),B({name:g.value,response_time:performance.now()-parseFloat(A.value),target_id:I.value},"colour_vision.html")):window.location="colour_vision.html"});let h={height:window.innerHeight,width:window.innerWidth};window.addEventListener("resize",()=>{let s=window.innerHeight,c=document.scrollingElement.scrollTop,d=window.innerWidth;if(g===document.activeElement&&s<h.height&&d===h.width){let{height:y,top:v}=g.getBoundingClientRect(),a=v+c-s+y+10;document.scrollingElement.scrollTop=a;let f=0,_=()=>{document.scrollingElement.scrollTop!==a&&(document.scrollingElement.scrollTop=a),f+=1,f<20&&requestAnimationFrame(_)};requestAnimationFrame(_)}h={height:s,width:d}})}var P=document.getElementById("appearance");P!==null&&(o({appearance:void 0}),P.addEventListener("change",()=>{let t=P.value;t!=="-"?(o({appearance:t}),B({square_disappeared:t},"observer_information.html")):o({appearance:void 0})}));var O=document.getElementById("age"),R=document.getElementById("gender"),D=document.getElementById("gender_other"),U=document.getElementById("colour_experience"),k=document.getElementById("language_experience"),F=document.getElementById("education_level"),j=document.getElementById("country_raised"),N=document.getElementById("country_resident"),H=document.getElementById("ambient_light"),q=document.getElementById("screen_temperature"),V=document.getElementById("display_device"),z=document.getElementById("screen_light"),G=document.getElementById("screen_distance"),J=document.getElementById("thank-you-page");O!==null&&G!==null&&F!==null&&z!==null&&U!==null&&R!==null&&D!==null&&j!==null&&k!==null&&H!==null&&q!==null&&N!==null&&V!==null&&J!==null&&(o({age:-1,distance:-1,educationalLevel:"",environment:"",experience:"",gender:"",genderOther:"",homeCountry:"",languageSkills:"",lightConditions:"",screenTemperature:"",residentCountry:"",displayDevice:""}),O.addEventListener("change",()=>{let t=O.value;o(t!=="-"?{age:parseInt(t,10)}:{age:void 0})}),G.addEventListener("change",()=>{let t=G.value;o(t!=="-"?{distance:t}:{distance:void 0})}),F.addEventListener("change",()=>{let t=F.value;o(t!=="-"?{educationalLevel:t}:{educationalLevel:void 0})}),z.addEventListener("change",()=>{let t=z.value;o(t!=="-"?{environment:t}:{environment:void 0})}),q.addEventListener("change",()=>{let t=q.value;o(t!=="-"?{screenTemperature:t}:{screenTemperature:void 0})}),U.addEventListener("change",()=>{let t=U.value;o(t!=="-"?{experience:t}:{experience:void 0})}),R.addEventListener("change",()=>{let t=R.value;o(t!=="-"?{gender:t}:{gender:void 0}),t=="other"?$("#specify-gender").show():$("#specify-gender").hide()}),D.addEventListener("change",()=>{let t=D.value;o(t!==""?{genderOther:t}:{genderOther:void 0})}),j.addEventListener("change",()=>{let t=j.value;o(t!=="-"?{homeCountry:t}:{homeCountry:void 0})}),k.addEventListener("change",()=>{let t=k.value;o(t!=="-"?{languageSkills:t}:{languageSkills:void 0})}),H.addEventListener("change",()=>{let t=H.value;o(t!=="-"?{lightConditions:t}:{lightConditions:void 0})}),N.addEventListener("change",()=>{let t=N.value;o(t!=="-"?{residentCountry:t}:{residentCountry:void 0})}),V.addEventListener("change",()=>{let t=V.value;o(t!=="-"?{displayDevice:t}:{displayDevice:void 0})}),J.addEventListener("click",t=>{t.preventDefault(),B({age:u.age,ambient_light:u.lightConditions,colour_experience:u.experience,country_raised:u.homeCountry,country_resident:u.residentCountry,education_level:u.educationalLevel,gender:u.gender,gender_other:u.genderOther,language_experience:u.languageSkills,screen_distance:u.distance,screen_light:u.environment,screen_temperature:u.screenTemperature,display_device:u.displayDevice,location:u.location},J.href)}));var be=document.getElementById("thank-you-text"),ee=document.getElementById("results");if(be!==null&&ee!==null){let{colours:t}=u;t&&Promise.all(Object.keys(t).map(i=>{let{name:h,value:s}=t[i],c=document.createElement("div"),d=document.createElement("li"),y=document.createElement("span"),v=document.createElement("span");c.style.backgroundColor=s,y.className="white",y.textContent=h;let a=s.match(/rgb\(([0-9]+),\s([0-9]+),\s([0-9]+)\)/).slice(1).map(f=>parseInt(f,10)).map(f=>f.toString(16)).join("");return d.appendChild(c),d.appendChild(y),d.appendChild(v),ee.appendChild(d),fetch(`/namer/lang/default/name?colour=${a}`,{credentials:"same-origin"}).then(f=>f.json()).then(f=>{v.className="black",v.textContent=f.colours[0].name.replace("_"," ")})}))}})();
//# sourceMappingURL=experiment.js.map
