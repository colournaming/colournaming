(()=>{var o=JSON.parse(localStorage.getItem("results")),n=e=>{o=Object.assign({},o,e),localStorage.setItem("results",JSON.stringify(o))},f=document.getElementById("levels");window.location.href.endsWith("observer_information.html")&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){n({location:String(e.coords.latitude+","+e.coords.longitude)})});var v=(e,i)=>{let r=new FormData;r.append("csrf_token",document.getElementById("csrf_token").value),Object.keys(e).forEach(t=>{r.append(t,e[t])}),fetch(window.location,{body:r,credentials:"same-origin",method:"POST"}).then(t=>{if(!t.ok)throw new Error(`HTTP error ${t.status}`);return console.log(t),t.redirected?(console.log("redirecting"),window.location=t.url):typeof i=="string"&&(console.log("setting window.location to "+i),window.location=i),t}).catch(t=>console.error("Error:",t))};f!==null&&(n({greyscaleRampSteps:void 0}),f.addEventListener("change",()=>{let e=f.value;e!=="-"?(n({greyscaleRampSteps:parseInt(e,10)}),v({levels:e,screen_colour_depth:screen.colorDepth,screen_height:screen.height,screen_width:screen.width},"name_colour.html")):n({greyscaleRampSteps:void 0})}));var E=document.getElementById("colour-circle"),h=document.getElementById("colour-id"),l=document.getElementById("colour-name"),F=document.getElementById("colour-name-form"),y=document.getElementById("colour-number"),j=document.getElementById("colour-vision-test-page"),_=document.getElementById("next-colour"),g=document.getElementById("response-time"),p=document.getElementById("start-time");if(E!==null&&h!==null&&l!==null&&F!==null&&y!==null&&j!==null&&_!==null&&g!==null&&p!==null){n({colours:void 0});let e=()=>fetch(COLOUR_NAME_TARGET_URL).then(t=>t.json()).then(({b:t,g:s,id:a,r:d})=>{E.style.backgroundColor=`rgb(${d}, ${s}, ${t})`,h.value=a,p.value=performance.now()}),i=()=>{let t={name:l.value,value:E.style.backgroundColor},s=o.colours?[...o.colours,t]:[t];n({colours:s})};e(),l.addEventListener("input",()=>{g.value===""&&(g.value=performance.now()-parseFloat(p.value))}),F.addEventListener("submit",t=>{t.preventDefault(),l.disabled=!0,_.disabled=!0,i(),v({name:l.value,response_time:parseFloat(g.value),target_id:h.value}),e().then(()=>{l.disabled=!1,_.disabled=!1,g.value="",l.focus()}),l.value="",typeof MAX_PRESENTATIONS>"u"||MAX_PRESENTATIONS==null?y.textContent=`#${o.colours?o.colours.length+1:0}`:y.textContent=`#${o.colours?o.colours.length+1:0} / ${MAX_PRESENTATIONS}`}),j.addEventListener("click",t=>{t.preventDefault(),l.value!==""?(i(),v({name:l.value,response_time:performance.now()-parseFloat(p.value),target_id:h.value},"name_colour.html")):window.location="observer_information.html"});let r={height:window.innerHeight,width:window.innerWidth};window.addEventListener("resize",()=>{let t=window.innerHeight,s=document.scrollingElement.scrollTop,a=window.innerWidth;if(l===document.activeElement&&t<r.height&&a===r.width){let{height:d,top:u}=l.getBoundingClientRect(),m=u+s-t+d+10;document.scrollingElement.scrollTop=m;let c=0,P=()=>{document.scrollingElement.scrollTop!==m&&(document.scrollingElement.scrollTop=m),c+=1,c<20&&requestAnimationFrame(P)};requestAnimationFrame(P)}r={height:t,width:a}})}var I=document.getElementById("appearance");I!==null&&(n({appearance:void 0}),I.addEventListener("change",()=>{let e=I.value;e!=="-"?(n({appearance:e}),v({square_disappeared:e},"observer_information.html")):n({appearance:void 0})}));var w=document.getElementById("age"),C=document.getElementById("gender"),B=document.getElementById("gender_other"),L=document.getElementById("colour_experience"),T=document.getElementById("language_experience"),S=document.getElementById("education_level"),b=document.getElementById("country_raised"),k=document.getElementById("country_resident"),x=document.getElementById("ambient_light"),O=document.getElementById("screen_temperature"),N=document.getElementById("display_device"),R=document.getElementById("screen_light"),D=document.getElementById("screen_distance"),A=document.getElementById("thank-you-page");w!==null&&D!==null&&S!==null&&R!==null&&L!==null&&C!==null&&B!==null&&b!==null&&T!==null&&x!==null&&O!==null&&k!==null&&N!==null&&A!==null&&(n({age:-1,distance:-1,educationalLevel:"",environment:"",experience:"",gender:"",genderOther:"",homeCountry:"",languageSkills:"",lightConditions:"",screenTemperature:"",residentCountry:"",displayDevice:""}),w.addEventListener("change",()=>{let e=w.value;n(e!=="-"?{age:parseInt(e,10)}:{age:void 0})}),D.addEventListener("change",()=>{let e=D.value;n(e!=="-"?{distance:e}:{distance:void 0})}),S.addEventListener("change",()=>{let e=S.value;n(e!=="-"?{educationalLevel:e}:{educationalLevel:void 0})}),R.addEventListener("change",()=>{let e=R.value;n(e!=="-"?{environment:e}:{environment:void 0})}),O.addEventListener("change",()=>{let e=O.value;n(e!=="-"?{screenTemperature:e}:{screenTemperature:void 0})}),L.addEventListener("change",()=>{let e=L.value;n(e!=="-"?{experience:e}:{experience:void 0})}),C.addEventListener("change",()=>{let e=C.value;n(e!=="-"?{gender:e}:{gender:void 0}),e=="other"?$("#specify-gender").show():$("#specify-gender").hide()}),B.addEventListener("change",()=>{let e=B.value;n(e!==""?{genderOther:e}:{genderOther:void 0})}),b.addEventListener("change",()=>{let e=b.value;n(e!=="-"?{homeCountry:e}:{homeCountry:void 0})}),T.addEventListener("change",()=>{let e=T.value;n(e!=="-"?{languageSkills:e}:{languageSkills:void 0})}),x.addEventListener("change",()=>{let e=x.value;n(e!=="-"?{lightConditions:e}:{lightConditions:void 0})}),k.addEventListener("change",()=>{let e=k.value;n(e!=="-"?{residentCountry:e}:{residentCountry:void 0})}),N.addEventListener("change",()=>{let e=N.value;n(e!=="-"?{displayDevice:e}:{displayDevice:void 0})}),A.addEventListener("click",e=>{e.preventDefault(),v({age:o.age,ambient_light:o.lightConditions,colour_experience:o.experience,country_raised:o.homeCountry,country_resident:o.residentCountry,education_level:o.educationalLevel,gender:o.gender,gender_other:o.genderOther,language_experience:o.languageSkills,screen_distance:o.distance,screen_light:o.environment,screen_temperature:o.screenTemperature,display_device:o.displayDevice,location:o.location},A.href)}));var M=document.getElementById("thank-you-text"),H=document.getElementById("results");if(M!==null&&H!==null){let{colours:e}=o;e&&Promise.all(Object.keys(e).map(i=>{let{name:r,value:t}=e[i],s=document.createElement("div"),a=document.createElement("li"),d=document.createElement("span"),u=document.createElement("span");s.style.backgroundColor=t,d.className="white",d.textContent=r;let m=t.match(/rgb\(([0-9]+),\s([0-9]+),\s([0-9]+)\)/).slice(1).map(c=>parseInt(c,10)).map(c=>c.toString(16)).join("");return a.appendChild(s),a.appendChild(d),a.appendChild(u),H.appendChild(a),fetch(`/namer/lang/default/name?colour=${m}`,{credentials:"same-origin"}).then(c=>c.json()).then(c=>{u.className="black",u.textContent=""})}))}})();
//# sourceMappingURL=experiment.js.map
