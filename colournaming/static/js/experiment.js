(()=>{var o=JSON.parse(localStorage.getItem("results")),n=e=>{o=Object.assign({},o,e),localStorage.setItem("results",JSON.stringify(o))},f=document.getElementById("levels");window.location.href.endsWith("observer_information.html")&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){n({location:String(e.coords.latitude+","+e.coords.longitude)})});var g=(e,i)=>{let c=new FormData;c.append("csrf_token",document.getElementById("csrf_token").value),Object.keys(e).forEach(t=>{c.append(t,e[t])}),fetch(window.location,{body:c,credentials:"same-origin",method:"POST"}).then(t=>{if(!t.ok)throw new Error(`HTTP error ${t.status}`);return console.log(t),t.redirected?(console.log("redirecting"),window.location=t.url):typeof i=="string"&&(console.log("setting window.location to "+i),window.location=i),t}).catch(t=>console.error("Error:",t))};f!==null&&(n({greyscaleRampSteps:void 0}),f.addEventListener("change",()=>{let e=f.value;e!=="-"?(n({greyscaleRampSteps:parseInt(e,10)}),g({levels:e,screen_colour_depth:screen.colorDepth,screen_height:screen.height,screen_width:screen.width},"name_colour.html")):n({greyscaleRampSteps:void 0})}));var E=document.getElementById("colour-circle"),h=document.getElementById("colour-id"),r=document.getElementById("colour-name"),P=document.getElementById("colour-name-form"),y=document.getElementById("colour-number"),F=document.getElementById("colour-vision-test-page"),H=document.getElementById("next-colour"),v=document.getElementById("response-time"),p=document.getElementById("start-time");if(E!==null&&h!==null&&r!==null&&P!==null&&y!==null&&F!==null&&H!==null&&v!==null&&p!==null){n({colours:void 0});let e=()=>{fetch(COLOUR_NAME_TARGET_URL).then(t=>t.json()).then(({b:t,g:s,id:a,r:d})=>{E.style.backgroundColor=`rgb(${d}, ${s}, ${t})`,h.value=a,p.value=performance.now()})},i=()=>{let t={name:r.value,value:E.style.backgroundColor},s=o.colours?[...o.colours,t]:[t];n({colours:s})};e(),r.addEventListener("input",()=>{v.value===""&&(v.value=performance.now()-parseFloat(p.value))}),P.addEventListener("submit",t=>{t.preventDefault(),i(),g({name:r.value,response_time:parseFloat(v.value),target_id:h.value}),e(),r.value="",typeof MAX_PRESENTATIONS=="undefined"||MAX_PRESENTATIONS==null?y.textContent=`#${o.colours?o.colours.length+1:0}`:y.textContent=`#${o.colours?o.colours.length+1:0} / ${MAX_PRESENTATIONS}`,v.value="",r.focus()}),F.addEventListener("click",t=>{t.preventDefault(),r.value!==""?(i(),g({name:r.value,response_time:performance.now()-parseFloat(p.value),target_id:h.value},"name_colour.html")):window.location="observer_information.html"});let c={height:window.innerHeight,width:window.innerWidth};window.addEventListener("resize",()=>{let t=window.innerHeight,s=document.scrollingElement.scrollTop,a=window.innerWidth;if(r===document.activeElement&&t<c.height&&a===c.width){let{height:d,top:u}=r.getBoundingClientRect(),m=u+s-t+d+10;document.scrollingElement.scrollTop=m;let l=0,A=()=>{document.scrollingElement.scrollTop!==m&&(document.scrollingElement.scrollTop=m),l+=1,l<20&&requestAnimationFrame(A)};requestAnimationFrame(A)}c={height:t,width:a}})}var _=document.getElementById("appearance");_!==null&&(n({appearance:void 0}),_.addEventListener("change",()=>{let e=_.value;e!=="-"?(n({appearance:e}),g({square_disappeared:e},"observer_information.html")):n({appearance:void 0})}));var I=document.getElementById("age"),w=document.getElementById("gender"),C=document.getElementById("gender_other"),B=document.getElementById("colour_experience"),L=document.getElementById("language_experience"),T=document.getElementById("education_level"),S=document.getElementById("country_raised"),b=document.getElementById("country_resident"),k=document.getElementById("ambient_light"),x=document.getElementById("screen_temperature"),O=document.getElementById("display_device"),N=document.getElementById("screen_light"),R=document.getElementById("screen_distance"),D=document.getElementById("thank-you-page");I!==null&&R!==null&&T!==null&&N!==null&&B!==null&&w!==null&&C!==null&&S!==null&&L!==null&&k!==null&&x!==null&&b!==null&&O!==null&&D!==null&&(n({age:-1,distance:-1,educationalLevel:"",environment:"",experience:"",gender:"",genderOther:"",homeCountry:"",languageSkills:"",lightConditions:"",screenTemperature:"",residentCountry:"",displayDevice:""}),I.addEventListener("change",()=>{let e=I.value;n(e!=="-"?{age:parseInt(e,10)}:{age:void 0})}),R.addEventListener("change",()=>{let e=R.value;n(e!=="-"?{distance:e}:{distance:void 0})}),T.addEventListener("change",()=>{let e=T.value;n(e!=="-"?{educationalLevel:e}:{educationalLevel:void 0})}),N.addEventListener("change",()=>{let e=N.value;n(e!=="-"?{environment:e}:{environment:void 0})}),x.addEventListener("change",()=>{let e=x.value;n(e!=="-"?{screenTemperature:e}:{screenTemperature:void 0})}),B.addEventListener("change",()=>{let e=B.value;n(e!=="-"?{experience:e}:{experience:void 0})}),w.addEventListener("change",()=>{let e=w.value;n(e!=="-"?{gender:e}:{gender:void 0}),e=="other"?$("#specify-gender").show():$("#specify-gender").hide()}),C.addEventListener("change",()=>{let e=C.value;n(e!==""?{genderOther:e}:{genderOther:void 0})}),S.addEventListener("change",()=>{let e=S.value;n(e!=="-"?{homeCountry:e}:{homeCountry:void 0})}),L.addEventListener("change",()=>{let e=L.value;n(e!=="-"?{languageSkills:e}:{languageSkills:void 0})}),k.addEventListener("change",()=>{let e=k.value;n(e!=="-"?{lightConditions:e}:{lightConditions:void 0})}),b.addEventListener("change",()=>{let e=b.value;n(e!=="-"?{residentCountry:e}:{residentCountry:void 0})}),O.addEventListener("change",()=>{let e=O.value;n(e!=="-"?{displayDevice:e}:{displayDevice:void 0})}),D.addEventListener("click",e=>{e.preventDefault(),g({age:o.age,ambient_light:o.lightConditions,colour_experience:o.experience,country_raised:o.homeCountry,country_resident:o.residentCountry,education_level:o.educationalLevel,gender:o.gender,gender_other:o.genderOther,language_experience:o.languageSkills,screen_distance:o.distance,screen_light:o.environment,screen_temperature:o.screenTemperature,display_device:o.displayDevice,location:o.location},D.href)}));var M=document.getElementById("thank-you-text"),j=document.getElementById("results");if(M!==null&&j!==null){let{colours:e}=o;e&&Promise.all(Object.keys(e).map(i=>{let{name:c,value:t}=e[i],s=document.createElement("div"),a=document.createElement("li"),d=document.createElement("span"),u=document.createElement("span");s.style.backgroundColor=t,d.className="white",d.textContent=c;let m=t.match(/rgb\(([0-9]+),\s([0-9]+),\s([0-9]+)\)/).slice(1).map(l=>parseInt(l,10)).map(l=>l.toString(16)).join("");return a.appendChild(s),a.appendChild(d),a.appendChild(u),j.appendChild(a),fetch(`/namer/lang/default/name?colour=${m}`,{credentials:"same-origin"}).then(l=>l.json()).then(l=>{u.className="black",u.textContent=l.colours[0].name.replace("_"," ")})}))}})();
//# sourceMappingURL=experiment.js.map
